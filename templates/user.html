{% extends "layout.html" %}

{% block title %}
    User
{% endblock %}

{% block head %}

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0"></script>

{% endblock %}

{% block script %}
  <script>

  const ctx = document.getElementById('userChart');

  new Chart(ctx, {
    type: 'line',
    label: 'Points',

    data: {
      datasets: [{
        data: {{ database | safe }}
      }]
    },

    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        title: {
          text: "Total User's Points",
          display: true
        },
        legend: {
          display: false
        }
      },
      scales: {
        x: {
          text: "Date",
          type: 'time',
          title: {
            display: true,
            text: 'Date'
          },
          time: {
            displayFormats: {
              quarter: 'day'
            }
          },
        },
        y: {
          title: {
            display: true,
            text: 'Points'
          }
        }
      },
    }
  });

// When the form is submitted, unhide the add to save button
let params = new URLSearchParams(window.location.search);
if (params.has('q')) {
    // Unhide the element
    document.querySelector('#add-to-save').classList.remove('hidden');
} 

</script>
{% endblock %}

{% block main %}

<div class="flex flex-col divide-y-4 divide-slate-400/25 mx-64 space-y-6">
  <div class="flex justify-center space-x-1">
    <form action="/user">
        <input class="text-slate-300 bg-indigo-950 hover:bg-indigo-800 rounded-lg p-3 w-1/16 m-5 shadow-lg" type="text" id="q" name="q" placeholder="Username" value="{{ username }}">
        <input type="checkbox" id="save" name="save" class="" {{ save }}>
        <label for="save" class="mr-5">Save data?</label>
        <button class="bg-indigo-950 hover:bg-indigo-800 duration-100 rounded-md px-3 py-1" type="submit">Lookup</button>
    </form>
  </div>
  <div class="h-96">
    <form class="hidden" id="add-to-save" action="/user" method="post">
      <button class="bg-indigo-950 hover:bg-indigo-800 duration-100 rounded-md px-3 py-1 m-4" type="submit" id="auto-save" name="auto-save" value="{{ username }}">Add user to auto save list?</button>
    </form>
    <canvas class="" id="userChart"></canvas>
  </div>
</div>

{% endblock %}